{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport { AppStatus } from \"../../../shared/pm2\";\nimport { useState } from 'react';\nimport useSWR from 'swr';\nimport { fetcher } from '../../../client/util';\nimport ErrorDisplay from '../ErrorDisplay';\nconst tabs = [{\n  title: 'Monitoring',\n  element: MonitoringTab\n}, {\n  title: 'Details',\n  element: DetailsTab\n}, {\n  title: 'Environment',\n  element: EnvironmentTab\n}, {\n  title: 'Logs',\n  element: LogsPanel\n}];\n\nfunction LogsPanel(props) {\n  const {\n    name,\n    pm_id\n  } = props.app;\n  const {\n    data,\n    error,\n    isValidating\n  } = useSWR(`/api/apps/${name}/${pm_id}/logs`, fetcher, {\n    refreshInterval: 3000\n  });\n\n  if (error) {\n    var _ref, _error$response, _ref2, _error$response2, _error$response2$data;\n\n    return __jsx(ErrorDisplay, {\n      title: (_ref = (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.statusText) !== null && _ref !== void 0 ? _ref : 'Error',\n      text: (_ref2 = (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) !== null && _ref2 !== void 0 ? _ref2 : error.toString()\n    });\n  }\n\n  return __jsx(\"div\", null, __jsx(\"div\", {\n    className: \"field\"\n  }, __jsx(\"label\", {\n    className: \"label\"\n  }, \"Output Logs\"), __jsx(\"div\", {\n    className: `control ${!data || isValidating ? 'is-loading' : ''}`\n  }, __jsx(\"textarea\", {\n    className: \"textarea\",\n    readOnly: true,\n    rows: 15,\n    value: data === null || data === void 0 ? void 0 : data.output.replace(/[\\u001b\\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g, '')\n  }))), __jsx(\"div\", {\n    className: \"field\"\n  }, __jsx(\"label\", {\n    className: \"label\"\n  }, \"Error Logs\"), __jsx(\"div\", {\n    className: `control ${!data || isValidating ? 'is-loading' : ''}`\n  }, __jsx(\"textarea\", {\n    className: \"textarea\",\n    readOnly: true,\n    rows: 15,\n    value: data === null || data === void 0 ? void 0 : data.error.replace(/[\\u001b\\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g, '')\n  }))));\n}\n\nfunction EnvironmentTab(props) {\n  const {\n    name,\n    pm2_env\n  } = props.app;\n  const {\n    env\n  } = pm2_env;\n  const keys = Object.keys(env).filter(k => k != name);\n  return __jsx(\"div\", {\n    className: \"table-container\",\n    style: {\n      width: '100%'\n    }\n  }, __jsx(\"table\", {\n    className: \"table is-narrow is-fullwidth is-bordered auto-overflow\",\n    style: {\n      tableLayout: 'fixed'\n    }\n  }, __jsx(\"thead\", null, __jsx(\"tr\", null, __jsx(\"th\", null, \"env_variable\"), __jsx(\"th\", null, \"value\"))), __jsx(\"tbody\", null, keys.length === 0 ? __jsx(\"tr\", null, __jsx(\"td\", {\n    colSpan: 2\n  }, \"There are no environment variables.\")) : keys.map(k => __jsx(\"tr\", {\n    key: k\n  }, __jsx(\"td\", null, k), __jsx(\"td\", null, env[k].toString()))))));\n}\n\nfunction DetailsTab(props) {\n  const {\n    pid,\n    pm_id,\n    name,\n    pm2_env\n  } = props.app;\n  const {\n    pm_exec_path,\n    exec_mode,\n    exec_interpreter,\n    restart_time,\n    unstable_restarts,\n    pm_out_log_path,\n    pm_err_log_path\n  } = pm2_env;\n  return __jsx(\"div\", null, __jsx(\"div\", {\n    className: \"field\"\n  }, __jsx(\"label\", {\n    className: \"label\"\n  }, \"Script Path\"), __jsx(\"div\", {\n    className: \"control\"\n  }, __jsx(\"input\", {\n    className: \"input\",\n    type: \"text\",\n    value: pm_exec_path,\n    readOnly: true\n  }))), __jsx(\"label\", {\n    className: \"label\"\n  }, \"Output Path\"), __jsx(\"div\", {\n    className: \"field is-grouped\"\n  }, __jsx(\"div\", {\n    className: \"control is-expanded\"\n  }, __jsx(\"input\", {\n    className: \"input\",\n    type: \"text\",\n    value: pm_out_log_path,\n    readOnly: true\n  })), __jsx(\"div\", {\n    className: \"control is-expanded\"\n  }, __jsx(\"input\", {\n    className: \"input\",\n    type: \"text\",\n    value: pm_err_log_path,\n    readOnly: true\n  }))), __jsx(\"table\", {\n    className: \"table is-fullwidth is-bordered\"\n  }, __jsx(\"thead\", null, __jsx(\"tr\", null, __jsx(\"th\", null, \"pm_id\"), __jsx(\"th\", null, \"pid\"), __jsx(\"th\", null, \"exec_mode\"), __jsx(\"th\", null, \"exec_interpreter\"))), __jsx(\"tbody\", null, __jsx(\"tr\", null, __jsx(\"td\", null, pm_id), __jsx(\"td\", null, pid), __jsx(\"td\", null, exec_mode), __jsx(\"td\", null, exec_interpreter))), __jsx(\"thead\", null, __jsx(\"tr\", null, __jsx(\"th\", {\n    colSpan: 2\n  }, \"restarts\"), __jsx(\"th\", {\n    colSpan: 2\n  }, \"unstable_restarts\"))), __jsx(\"tbody\", null, __jsx(\"tr\", null, __jsx(\"td\", {\n    colSpan: 2\n  }, restart_time), __jsx(\"td\", {\n    colSpan: 2\n  }, unstable_restarts)))));\n}\n\nconst bytesInMb = 1024 ** 2;\n\nfunction MonitoringTab(props) {\n  const {\n    monit,\n    pm2_env\n  } = props.app;\n  const {\n    cpu,\n    memory\n  } = monit;\n  const {\n    status\n  } = pm2_env;\n  return __jsx(\"table\", {\n    className: \"table status-table is-fullwidth is-centered\"\n  }, __jsx(\"thead\", null, __jsx(\"tr\", {\n    className: `is-size-5 ${status === AppStatus.ONLINE || status === AppStatus.ONE_LAUNCH ? 'is-online' : 'is-offline'}`\n  }, __jsx(\"th\", null, \"status\"), __jsx(\"th\", null, \"memory\"), __jsx(\"th\", null, \"cpu\"))), __jsx(\"tbody\", null, __jsx(\"tr\", null, __jsx(\"td\", null, status), __jsx(\"td\", null, (memory / bytesInMb).toFixed(2), \"mb\"), __jsx(\"td\", null, cpu, \"%\"))));\n}\n\n;\nexport default function (_ref3) {\n  let props = Object.assign({}, _ref3);\n  const {\n    0: tabIndex,\n    1: setTab\n  } = useState(0);\n  const app = props.app;\n  const {\n    pid\n  } = app;\n  const Element = tabs[tabIndex].element;\n  return __jsx(\"div\", {\n    className: \"box\"\n  }, __jsx(\"div\", null, __jsx(\"p\", {\n    style: {\n      marginBottom: '-2rem'\n    }\n  }, \"pid: \", pid)), __jsx(\"div\", {\n    className: \"tabs is-centered\"\n  }, __jsx(\"ul\", null, tabs.map((t, index) => __jsx(\"li\", {\n    key: t.title,\n    className: index == tabIndex ? 'is-active' : '',\n    onClick: () => setTab(index)\n  }, __jsx(\"a\", null, t.title))))), __jsx(Element, {\n    app: app\n  }));\n}","map":null,"metadata":{},"sourceType":"module"}
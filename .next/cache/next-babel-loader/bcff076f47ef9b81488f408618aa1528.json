{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _statusIcon;\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport moment from 'moment';\nimport Router from 'next/router';\nimport ErrorDisplay from './ErrorDisplay';\nimport { AppStatus, ExecMode } from '../../shared/pm2';\nimport ClusterIcon from './ClusterIcon';\nimport WatchIcon from './WatchIcon';\nimport TableHead from './TableHead';\n\nfunction TableCell(_ref) {\n  var children = _ref.children,\n      props = _objectWithoutProperties(_ref, [\"children\"]);\n\n  return __jsx(\"td\", props, children);\n}\n\n;\n\nvar getTextContent = function getTextContent(children) {\n  var text = '';\n\n  if (!Array.isArray(children)) {\n    children = [children];\n  }\n\n  for (var i = 0; i < children.length; i++) {\n    var c = children[i];\n\n    if (c === undefined || c === null) {\n      continue;\n    }\n\n    if (Array.isArray(c)) {\n      text += getTextContent(c);\n    }\n\n    if (typeof c === 'object') {\n      var _c$props;\n\n      text += getTextContent((_c$props = c.props) === null || _c$props === void 0 ? void 0 : _c$props.children);\n      continue;\n    }\n\n    text += c;\n  }\n\n  ;\n  return text;\n};\n\nvar functionalCell = function functionalCell(id) {\n  return function (_ref2) {\n    var children = _ref2.children,\n        props = _objectWithoutProperties(_ref2, [\"children\"]);\n\n    var attr = {\n      onClick: function onClick() {\n        return Router.push(\"/apps/[id]\", \"/apps/\".concat(id));\n      },\n      onContextMenu: function onContextMenu(e) {\n        var textToCopy = getTextContent(children);\n        e.preventDefault();\n        navigator.clipboard.writeText(textToCopy)[\"catch\"](console.log);\n      },\n      style: {\n        cursor: 'pointer'\n      }\n    };\n    return __jsx(TableCell, _extends({}, attr, props), children);\n  };\n};\n\nvar statusIcon = (_statusIcon = {}, _defineProperty(_statusIcon, AppStatus.ONLINE, function () {\n  return __jsx(\"span\", {\n    className: \"icon is-pulled-right\",\n    style: {\n      marginLeft: '10px'\n    }\n  }, __jsx(\"i\", {\n    className: \"fas fa-play has-text-success\"\n  }));\n}), _defineProperty(_statusIcon, AppStatus.STOPPING, function () {\n  return __jsx(\"span\", {\n    className: \"icon is-pulled-right\",\n    style: {\n      marginLeft: '10px'\n    }\n  }, __jsx(\"i\", {\n    className: \"fas fa-stop-circle\"\n  }));\n}), _defineProperty(_statusIcon, AppStatus.STOPPED, function () {\n  return __jsx(\"span\", {\n    className: \"icon is-pulled-right\",\n    style: {\n      marginLeft: '10px'\n    }\n  }, __jsx(\"i\", {\n    className: \"fas fa-stop\"\n  }));\n}), _defineProperty(_statusIcon, AppStatus.LAUNCHING, function () {\n  return __jsx(\"span\", {\n    className: \"icon is-pulled-right\",\n    style: {\n      marginLeft: '10px'\n    }\n  }, __jsx(\"i\", {\n    className: \"fas fa-rocket has-text-primary\"\n  }));\n}), _defineProperty(_statusIcon, AppStatus.ERRORED, function () {\n  return __jsx(\"span\", {\n    className: \"icon is-pulled-right\",\n    style: {\n      marginLeft: '10px'\n    }\n  }, __jsx(\"i\", {\n    className: \"fas fa-exclamation-triangle has-text-danger\"\n  }));\n}), _defineProperty(_statusIcon, AppStatus.ONE_LAUNCH, function () {\n  return __jsx(\"span\", {\n    className: \"icon is-pulled-right\",\n    style: {\n      marginLeft: '10px'\n    }\n  }, __jsx(\"i\", {\n    className: \"fas fa-asterisk\"\n  }));\n}), _statusIcon);\nvar bytesInMb = Math.pow(1024, 2);\n\nfunction ApplicationRow(_ref3) {\n  var app = _ref3.app,\n      _ref3$isFirst = _ref3.isFirst,\n      isFirst = _ref3$isFirst === void 0 ? false : _ref3$isFirst;\n  var _ref4 = app,\n      pid = _ref4.pid,\n      id = _ref4.pm_id,\n      name = _ref4.name,\n      monit = _ref4.monit,\n      pm2_env = _ref4.pm2_env;\n  var memory = monit.memory,\n      cpu = monit.cpu;\n  var watch = pm2_env.watch,\n      restarts = pm2_env.restart_time,\n      unstableRestarts = pm2_env.unstable_restarts,\n      uptime = pm2_env.pm_uptime,\n      status = pm2_env.status,\n      execMode = pm2_env.exec_mode;\n  var icon = statusIcon[status] ? statusIcon[status]() : null;\n  var mup = moment(uptime);\n  var Td = functionalCell(name);\n  var details = \"\".concat(name, \"\\npid: \").concat(pid);\n\n  var postfix = __jsx(React.Fragment, null, execMode === ExecMode.CLUSTER ? __jsx(React.Fragment, null, \" (\".concat(pid, \")\"), __jsx(ClusterIcon, null)) : null, watch ? __jsx(WatchIcon, null) : null);\n\n  return __jsx(\"tr\", null, __jsx(Td, null, id), __jsx(Td, {\n    className: \"has-tooltip-\".concat(isFirst ? 'right' : 'top'),\n    \"data-tooltip\": details\n  }, name, postfix), __jsx(Td, null, icon, status), __jsx(Td, {\n    \"data-tooltip\": mup.calendar()\n  }, mup.fromNow(true)), __jsx(Td, null, restarts, unstableRestarts > 0 ? [' + ', __jsx(\"b\", {\n    key: \"unstable-restarts\",\n    className: \"has-text-danger has-tooltip-danger\",\n    \"data-tooltip\": \"this application had \".concat(unstableRestarts, \" unstable restart\").concat(unstableRestarts != 1 ? 's' : '')\n  }, unstableRestarts)] : null), __jsx(Td, null, (memory / bytesInMb).toFixed(2), \"mb\"), __jsx(Td, null, cpu, \"%\"));\n}\n\n;\n\nfunction LoadingBar() {\n  return __jsx(\"progress\", {\n    className: \"progress is-small is-info\",\n    max: \"100\"\n  }, \"Loading...\");\n}\n\nfunction EmptyTable() {\n  return __jsx(\"div\", {\n    style: {\n      textAlign: 'center',\n      width: '100%',\n      padding: '10px'\n    }\n  }, __jsx(\"p\", {\n    className: \"subtitle\"\n  }, \"There are no applications.\"));\n}\n\nexport default function (props) {\n  var _props$apps = props.apps,\n      apps = _props$apps === void 0 ? [] : _props$apps,\n      _props$isLoading = props.isLoading,\n      isLoading = _props$isLoading === void 0 ? false : _props$isLoading,\n      _props$error = props.error,\n      error = _props$error === void 0 ? null : _props$error;\n\n  if (error) {\n    var _ref5, _error$response, _ref6, _error$response2, _error$response2$data;\n\n    var title = (_ref5 = (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.statusText) !== null && _ref5 !== void 0 ? _ref5 : 'Error';\n    var text = (_ref6 = (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) !== null && _ref6 !== void 0 ? _ref6 : error.toString();\n    return __jsx(ErrorDisplay, {\n      title: title,\n      text: text,\n      style: {\n        width: '100%'\n      }\n    });\n  }\n\n  if (isLoading) {\n    return __jsx(LoadingBar, null);\n  }\n\n  if (apps.length === 0) {\n    return __jsx(EmptyTable, null);\n  }\n\n  var rows = apps.map(function (app, index) {\n    return __jsx(ApplicationRow, {\n      key: \"app_row_\".concat(app.pid),\n      app: app,\n      isFirst: index === 0\n    });\n  });\n  return __jsx(\"div\", {\n    className: \"table-container\",\n    style: {\n      width: '100%'\n    }\n  }, __jsx(\"table\", {\n    className: \"table is-fullwidth is-bordered is-striped is-hoverable\"\n  }, __jsx(TableHead, {\n    columns: ['id', 'name', 'status', 'uptime', 'restarts', 'memory', 'cpu']\n  }), __jsx(\"tbody\", null, rows)));\n}\n;","map":null,"metadata":{},"sourceType":"module"}
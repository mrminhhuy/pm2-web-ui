{"ast":null,"code":"import * as mongoose from 'mongoose';\nimport { UserModel, User } from '../models/user';\nimport config from '../config';\nexport default (fn => {\n  return async (req, res) => {\n    var _mongoose$connection;\n\n    if (((_mongoose$connection = mongoose.connection) === null || _mongoose$connection === void 0 ? void 0 : _mongoose$connection.readyState) != 1) {\n      await mongoose.connect(config.mongodbUri, {\n        useNewUrlParser: true,\n        useUnifiedTopology: true\n      });\n      UserModel.updateOne({\n        username: 'root'\n      }, {\n        $set: {\n          isAdmin: true,\n          hashedPassword: User.hash(config.salt)\n        }\n      }, {\n        upsert: true\n      }).catch(err => console.error(`Failed to update the root user: ${err}`));\n    }\n\n    return await fn(req, res);\n  };\n});","map":null,"metadata":{},"sourceType":"module"}
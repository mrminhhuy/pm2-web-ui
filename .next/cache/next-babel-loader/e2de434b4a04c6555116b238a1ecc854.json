{"ast":null,"code":"import { UserModel, User } from '../../server/models/user';\nimport { database, session, method, combine, RequestError } from '../../server/middlewares';\nimport * as validate from '../../shared/validation';\n\nconst login = async (req, res) => {\n  const {\n    username,\n    password\n  } = req.body;\n\n  if (!validate.all(validate.username(username), validate.password(password))) {\n    throw new RequestError('Invalid username or password.', 400);\n  }\n\n  const user = await UserModel.findOne({\n    username,\n    hashedPassword: User.hash(password)\n  });\n\n  if (!user) {\n    throw new RequestError('User with given username and password was not found.', 403);\n  }\n\n  req.session.userId = user._id;\n  res.status(200).json(user.getPublicData());\n};\n\nexport default combine(method('POST'), database, session, login);","map":null,"metadata":{},"sourceType":"module"}
(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{Ozl8:function(e,t,n){"use strict";var a=n("wx14"),l=n("Ff2n"),r=n("q1tI"),o=n.n(r),i=n("DBJP"),s=o.a.createElement;t.a=function(e){var t=e.pull,n=void 0===t?"right":t,r=Object(l.a)(e,["pull"]);return s(i.a,Object(a.a)({className:n?"is-pulled-".concat(n):"",icon:"fa-layer-group",style:{marginLeft:"10px",display:"inline"}},r))}},TPrw:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/apps/[id]",function(){return n("hPbj")}])},hPbj:function(e,t,n){"use strict";n.r(t);var a=n("wx14"),l=n("o0o1"),r=n.n(l),o=n("q1tI"),i=n.n(o),s=n("nOHt"),c=n("/MKj"),u=n("VtrM"),p=n("UJ/n"),d=n("muLP"),b=n("AD/7"),f=n("vDqi"),v=n.n(f),O=n("jcc4"),m=n("rePB"),g=n("Ff2n"),h=n("DBJP"),y=i.a.createElement,j={disabled:!0,text:"...",icon:"fa-bug",color:"is-danger"},N=function(e){var t=e.traits,n=e.status,l=e.disabled,r=e.loading,o=void 0!==r&&r,i=Object(g.a)(e,["traits","status","disabled","loading"]),s=t[n]||j,c=s.disabled,u=s.text,p=s.icon,d=s.color;return y("button",Object(a.a)({className:"button ".concat(d," ").concat(o?"is-loading":""),disabled:c||o||l},i),y(h.a,{className:"is-small",icon:p}),y("span",null,u))},E=i.a.createElement;function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=Object(m.a)({stopped:{disabled:!1,text:"Start",icon:"fa-play",color:"is-success"},online:{disabled:!1,text:"Stop",icon:"fa-stop",color:"is-danger"},stopping:null,launching:null,errored:null},"one-launch-status",null);x.errored=x.stopped,x["one-launch-status"]=x.online,x.stopping=P({},x.stopped,{disabled:!0}),x.launching=P({},x.online,{disabled:!0});var _=function(e){return E(N,Object(a.a)({},e,{traits:x}))},S=i.a.createElement;function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var D=Object(m.a)({online:{disabled:!1,text:"Restart",icon:"fa-redo-alt",color:"is-link"},stopping:null,launching:null,errored:null,stopped:null},"one-launch-status",null);D.stopped=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},D.online,{disabled:!0}),D.errored=D.stopped,D["one-launch-status"]=D.stopped,D.stopping=D.stopped,D.launching=D.stopped;var A=function(e){return S(N,Object(a.a)({},e,{traits:D}))},k=i.a.createElement;function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var R=Object(m.a)({stopped:{disabled:!1,text:"Delete",icon:"fa-trash-alt",color:"is-dark"},stopping:null,launching:null,errored:null,online:null},"one-launch-status",null);R.errored=R.stopped,R.online=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},R.stopped,{disabled:!0}),R["one-launch-status"]=R.online,R.stopping=R.online,R.launching=R.online;var C,I=function(e){return k(N,Object(a.a)({},e,{traits:R}))},U=i.a.createElement,B=function(e){var t=e.title,n=e.children,a=void 0===n?null:n,l=e.onUpdate,r=void 0===l?null:l,o=e.canUpdate,i=void 0!==o&&o;return U("div",{className:"container panel is-info"},U("div",{className:"panel-heading"},t,U("a",{className:"button button-primary is-pulled-right is-light is-outlined ".concat(i?"":"is-loading"),style:{marginTop:"-6px"},onClick:function(){return i&&r()}},"Update")),U("div",{className:"panel-block",style:{width:"100%"}},a))},M=n("3xcS"),G=n("mBNB");!function(e){e.START="start",e.STOP="stop",e.RESTART="restart",e.RELOAD="reload",e.DELETE="delete"}(C||(C={}));var q=i.a.createElement;function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var J=Object(m.a)({online:{disabled:!1,text:"Reload",icon:"fa-sync-alt",color:"is-primary"},stopping:null,launching:null,errored:null,stopped:null},"one-launch-status",null);J.stopped=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},J.online,{disabled:!0}),J.errored=J.stopped,J["one-launch-status"]=J.stopped,J.stopping=J.stopped,J.launching=J.stopped;var V=function(e){return q(N,Object(a.a)({},e,{traits:J}))},F=n("Ozl8"),z=i.a.createElement,K=[{title:"Monitoring",element:function(e){var t=e.app,n=t.monit,a=t.pm2_env,l=n.cpu,r=n.memory,o=a.status;return z("table",{className:"table status-table is-fullwidth is-centered"},z("thead",null,z("tr",{className:"is-size-5 ".concat(o===G.a.ONLINE||o===G.a.ONE_LAUNCH?"is-online":"is-offline")},z("th",null,"status"),z("th",null,"memory"),z("th",null,"cpu"))),z("tbody",null,z("tr",null,z("td",null,o),z("td",null,(r/W).toFixed(2),"mb"),z("td",null,l,"%"))))}},{title:"Details",element:function(e){var t=e.app,n=t.pid,a=t.pm_id,l=(t.name,t.pm2_env),r=l.pm_exec_path,o=l.exec_mode,i=l.exec_interpreter,s=l.restart_time,c=l.unstable_restarts,u=l.pm_out_log_path,p=l.pm_err_log_path;return z("div",null,z("div",{className:"field"},z("label",{className:"label"},"Script Path"),z("div",{className:"control"},z("input",{className:"input",type:"text",value:r,readOnly:!0}))),z("label",{className:"label"},"Output Path"),z("div",{className:"field is-grouped"},z("div",{className:"control is-expanded"},z("input",{className:"input",type:"text",value:u,readOnly:!0})),z("div",{className:"control is-expanded"},z("input",{className:"input",type:"text",value:p,readOnly:!0}))),z("table",{className:"table is-fullwidth is-bordered"},z("thead",null,z("tr",null,z("th",null,"pm_id"),z("th",null,"pid"),z("th",null,"exec_mode"),z("th",null,"exec_interpreter"))),z("tbody",null,z("tr",null,z("td",null,a),z("td",null,n),z("td",null,o),z("td",null,i))),z("thead",null,z("tr",null,z("th",{colSpan:2},"restarts"),z("th",{colSpan:2},"unstable_restarts"))),z("tbody",null,z("tr",null,z("td",{colSpan:2},s),z("td",{colSpan:2},c)))))}},{title:"Environment",element:function(e){var t=e.app,n=t.name,a=t.pm2_env.env,l=Object.keys(a).filter((function(e){return e!=n}));return z("div",{className:"table-container",style:{width:"100%"}},z("table",{className:"table is-narrow is-fullwidth is-bordered auto-overflow",style:{tableLayout:"fixed"}},z("thead",null,z("tr",null,z("th",null,"env_variable"),z("th",null,"value"))),z("tbody",null,0===l.length?z("tr",null,z("td",{colSpan:2},"There are no environment variables.")):l.map((function(e){return z("tr",{key:e},z("td",null,e),z("td",null,a[e].toString()))})))))}},{title:"Logs",element:function(e){var t,n,a,l,r,o=e.app,i=o.name,s=o.pm_id,c=Object(u.a)("/api/apps/".concat(i,"/").concat(s,"/logs"),p.a,{refreshInterval:3e3}),d=c.data,b=c.error,f=c.isValidating;return b?z(M.a,{title:null!==(t=null===(n=b.response)||void 0===n?void 0:n.statusText)&&void 0!==t?t:"Error",text:null!==(a=null===(l=b.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)&&void 0!==a?a:b.toString()}):z("div",null,z("div",{className:"field"},z("label",{className:"label"},"Output Logs"),z("div",{className:"control ".concat(!d||f?"is-loading":"")},z("textarea",{className:"textarea",readOnly:!0,rows:15,value:null===d||void 0===d?void 0:d.output.replace(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,"")}))),z("div",{className:"field"},z("label",{className:"label"},"Error Logs"),z("div",{className:"control ".concat(!d||f?"is-loading":"")},z("textarea",{className:"textarea",readOnly:!0,rows:15,value:null===d||void 0===d?void 0:d.error.replace(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,"")}))))}}];var W=Math.pow(1024,2);var X=function(e){var t=Object(a.a)({},e),n=Object(o.useState)(0),l=n[0],r=n[1],i=t.app,s=i.pid,c=K[l].element;return z("div",{className:"box"},z("div",null,z("p",{style:{marginBottom:"-2rem"}},"pid: ",s)),z("div",{className:"tabs is-centered"},z("ul",null,K.map((function(e,t){return z("li",{key:e.title,className:t==l?"is-active":"",onClick:function(){return r(t)}},z("a",null,e.title))})))),z(c,{app:i}))},Z=i.a.createElement,Q=(Math.pow(1024,2),function(e){var t=e.apps;return Z("div",{className:"container"},Z("style",null,"\n        tr { display: flex; }\n        tr > th, td { flex: 1; text-align: center!important; }\n        .is-online > th { border-color: #48c774!important; }\n        .is-offline > th { border-color: #f14668!important; }\n        .auto-overflow > th, td { overflow: auto;  }\n      "),t.map((function(e,t){return Z(X,{key:"".concat(e.pid,"_").concat(t),app:e})})))}),Y=n("v9gO"),$=i.a.createElement;t.default=Object(d.a)(Object(b.a)((function(){var e,t,n,l,i,d,b,f,m=Object(o.useRef)(!0),g=Object(c.d)((function(e){return e.client})),h=Object(o.useState)(!1),y=h[0],j=h[1],N=Object(o.useState)(null),E=N[0],w=N[1],P=Object(s.useRouter)().query.id,x=Object(u.a)("/api/apps/".concat(P),p.a,{refreshInterval:3e3}),S=x.data,T=x.error,D=x.isValidating,k=x.revalidate,L=!D&&(S||T);if(!S||T)return $(O.a,null,$(B,{title:P,canUpdate:L,onUpdate:function(){return k()}},T?$(M.a,{style:{width:"100%"},title:null!==(l=null===(i=T.response)||void 0===i?void 0:i.statusText)&&void 0!==l?l:"Error",text:null!==(d=null===(b=T.response)||void 0===b?void 0:null===(f=b.data)||void 0===f?void 0:f.message)&&void 0!==d?d:T.toString()}):$("progress",{className:"progress is-small is-info",max:"100"},"Loading...")));var R=null!==(e=null===(t=g.apps.find((function(e){return e.id===P})))||void 0===t?void 0:t.right)&&void 0!==e?e:0,U=g.isAdmin||(R&Y.a.MANAGE)===Y.a.MANAGE,q=g.isAdmin||(R&Y.a.DELETE)===Y.a.DELETE,H=S.app,J=(H.pm_id,H.name),z=H.exec_mode,K=H.instances,W=null===(n=K[0])||void 0===n?void 0:n.pm2_env.status,X=W===G.a.ONLINE||W===G.a.LAUNCHING||W===G.a.ONE_LAUNCH,Z=z===G.b.CLUSTER,ee={status:W};y&&(ee.loading=!0);var te=function(e){var t,n,a,l,o;return r.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return j(!0),w(null),i.prev=2,i.next=5,r.a.awrap(v.a.post("/api/apps/".concat(J),{action:e}));case 5:i.next=10;break;case 7:i.prev=7,i.t0=i.catch(2),m&&w([null!==(t=null===(n=i.t0.response)||void 0===n?void 0:n.statusText)&&void 0!==t?t:"Error",null!==(a=null===(l=i.t0.response)||void 0===l?void 0:null===(o=l.data)||void 0===o?void 0:o.message)&&void 0!==a?a:i.t0.toString()]);case 10:if(!m){i.next=14;break}return i.next=13,r.a.awrap(k());case 13:j(!1);case 14:case"end":return i.stop()}}),null,null,[[2,7]],Promise)};return $(O.a,null,$("div",{className:"container panel is-info"},$("div",{className:"panel-heading"},P,Z&&$(F.a,{pull:null}),$("a",{className:"button button-primary is-pulled-right is-light is-outlined ".concat(L?"":"is-loading"),style:{marginTop:"-6px"},onClick:function(){return k()}},"Update")),$("div",{className:"panel-block is-block"},$("style",null,".is-inline-flex > button { flex: 1; }"),$("div",{className:"buttons is-inline-flex",style:{width:"100%"}},$(_,Object(a.a)({},ee,{disabled:!U,onClick:function(){return te(X?C.STOP:C.START)}})),Z&&$(V,Object(a.a)({},ee,{disabled:!U,onClick:function(){return te(C.RELOAD)}})),$(A,Object(a.a)({},ee,{disabled:!U,onClick:function(){return te(C.RESTART)}})),$(I,Object(a.a)({},ee,{disabled:!q,onClick:function(){return te(C.DELETE)}})),E&&$(M.a,{color:"is-warning",style:{width:"100%",marginBottom:"10px"},title:E[0],text:E[1]})))),$(Q,{apps:K}))})))},mBNB:function(e,t,n){"use strict";var a,l;n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return l})),function(e){e.ONLINE="online",e.STOPPING="stopping",e.STOPPED="stopped",e.LAUNCHING="launching",e.ERRORED="errored",e.ONE_LAUNCH="one-launch-status"}(a||(a={})),function(e){e.CLUSTER="cluster_mode",e.FORK="fork_mode"}(l||(l={}))},v9gO:function(e,t,n){"use strict";var a;n.d(t,"a",(function(){return a})),function(e){e[e.NONE=0]="NONE",e[e.VIEW=1]="VIEW",e[e.MANAGE=2]="MANAGE",e[e.DELETE=4]="DELETE",e[e.INTERACT=8]="INTERACT"}(a||(a={}))}},[["TPrw",0,2,1,3,4]]]);